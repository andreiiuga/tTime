<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>React JS</title>
</head>
<body>
    <div id="app"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.16.1/axios.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="index.css">
  	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
  	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/babel">

    	class Shirt extends React.Component {
    		constructor(props) {
				super(props);
			};

			render() {
				var status;
				var temp = this.props.weather_info.main.temp;
				var humidity = this.props.weather_info.main.humidity;
				var wind_speed = this.props.weather_info.wind.speed;

				var comfort_grade = (this.props.weather_info.main.temp*100)/45 - humidity - (wind_speed*100)/117;

				console.log(comfort_grade);

				if(comfort_grade > 10){
					status=true;
				}
				else{
					status=false;
				}

				if(comfort_grade > 10 && comfort_grade < 25) {
					return(
						<div className="info-wraper">
							Maybe Go for T-shirt
							<img height="100" width="100" src="tshirt.svg"/>
						</div>
					)
				} else  if(comfort_grade > 25) {
					return(
						<div className="info-wraper">
							Defenitely Go for T-shirt
							<img height="100" width="100" src="tshirt_hot.png"/>
						</div>
					)
				} else {
					return(
						<div className="info-wraper">
							Not a great time for T-shirt
						</div>
					)
				}
			}
		}

    	class HelloComponent extends React.Component {

    		constructor(props) {
				super(props);
				this.state = {city: 'Bucharest'};
			};

    		getWeatherInfo(city) {
    			var xhr = new XMLHttpRequest();
				xhr.open("GET", `http://api.openweathermap.org/data/2.5/weather?units=metric&q=${city}&APPID=30719c8a2baaffbfaaef83f39373f66d`, false);
				xhr.send();

				const weather_data = JSON.parse(xhr.response);
				console.log(weather_data);
				return weather_data;
    		};

    		changeLocation(e) {
    			console.log("ajunge");
		        e.preventDefault();
    			var city_ref = this.refs.city;
    			var city_name = city_ref.value;
    			this.setState({city: city_name});
    		};

		    render() {
		    	console.log("PLEASE DEACTIVATE HTTPS CONECTIONS BECAUSE THE API CALS ARE NOT SECURE");

		        const weather = this.getWeatherInfo(this.state.city);
		        const icon_url = "http://openweathermap.org/img/w/" + weather.weather[0].icon +".png";

		        return (
		        	<span className="app">
			        	<h1 className="title">
			        		<span className="title-text">tTime</span>
			        	</h1>
			        	<div className="search-bar-wraper">
				        	<div className="search-bar">
					            <form onSubmit={this.changeLocation.bind(this)}>
							    	<div className="input-group">
							      		<input type="text"
							      		ref="city"
							      		id="input_city"
							      		className="form-control"
							      		placeholder="Your City Here"
							      		/>
							      		<div className="input-group-btn">
							        		<div
							        		id="buton"
							        		onClick={this.changeLocation.bind(this)}
							        		className="btn btn-default">
							        			<i className="glyphicon glyphicon-search"></i>
							        		</div>
							      		</div>
							    	</div>
							  	</form>
							</div>
						</div>
			        	<div id="weather" className="info-wraper">Currently in {weather.name} is {weather.weather[0].description}</div>
			        	<div id="temp" className="info-wraper">Temperature is arround {weather.main.temp}Â°C</div>
			        	<div id="temp" className="info-wraper">Humidity in air is {weather.main.humidity}%</div>
			        	<div id="wind" className="info-wraper">Wind is going {weather.wind.speed} miles/hour</div>
			        	<div id="icon" className="info-wraper"><img src={icon_url}/></div>
			        	<div className="info-wraper">so</div>
			        	<div id="shirt_comp"><Shirt weather_info={weather}/></div>
				  	</span>
		        )
		    }
		}
		ReactDOM.render(<HelloComponent />, document.querySelector('#app'))
    </script>
</body>
</html>